services:
  # Add DAML directory mount to participant
  participant:
    volumes:
      - ../deserve/daml:/daml:ro

  # Add DAML upload service
  daml-uploader:
    image: digitalasset/daml-sdk:2.8.0
    volumes:
      - ../deserve/daml/.daml/dist:/dars:ro # Mount only the built DARs
      - ./upload-daml.sh:/upload-daml.sh
    working_dir: /
    command: ["/upload-daml.sh"]
    depends_on:
      participant:
        condition: service_healthy
    restart: "no"
    environment:
      - DAML_SDK_VERSION=2.8.0
